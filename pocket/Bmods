#!/bin/zsh
#
# FileName:     Bmods
# Author:       8ucchiman
# CreatedDate:  2023-07-27 13:10:49
# LastModified: 2023-12-21 12:53:25
# Reference:    https://unix.stackexchange.com/questions/33255/how-to-define-and-load-your-own-shell-function-in-zsh
#               https://sig9.org/archives/1120
#               https://qiita.com/icoxfog417/items/adbbf445d357c924b8fc
# Description:  ---
#

# set -ex

#@ archive
function pass () {
    #
    # @Description  Identity function, like python
    # @params       
    # @Example      pass
    # @Reference    
    #

}

#@ init
function init () {
    #
    # @Description  install packages
    # @params       
    # @Example      init
    # @Reference    
    #

    install_system
    if ! _has cargo; then install_rust; fi
    if ! _has nvim; then install_neovim; fi
    if ! _has fzf; then install_fzf; fi
    if ! _has bat; then install_bat; fi
    if ! _has exa; then install_exa; fi
    if ! _has starthip; then install_starship; fi
    if ! _has dbxcli; then install_dropbox; fi
    if ! _has dust; then install_dust; fi
}

#@
function google_script () {
    function _sample () {
        mkdir -p /tmp/8ucchiman/google_script_sample; cd $_
        clasp create

/bin/cat <<eos > main.js
function test () {
    console.log('Hello World!');
}
eos
        clasp push
        clasp open
    }
    _sample
}

#@ install
function install_lldb () {
    sudo apt install -y lldb
}

#@
function github_action () {
    local -A reference_lst=(
        qiita01         https://qiita.com/shun198/items/14cdba2d8e58ab96cf95
    )
    local target_ref=`array_fzf "$reference_lst[*]"`
    nohup google-chrome ${reference_lst[$target_ref]} &
}

#@ install
function install_markdown () {
    pip install grip
    cargo install --locked mdcat
}

#@ $1 git
function _create_WIPissue () {
    #
    # @Description  create Working in progress issue
    # @params       $1: issue_number
    # @Example      create_WIPissue 44
    #               create_WIPissue # interactive mode
    # @Reference    
    #

    #set -xe
    local issue_number=$1
    if [[ $# == 0 ]]; then
        issue_number=`gh issue list | fzf --height 100% | awk '{print $1}'`
    fi
    gh issue develop $issue_number --base dev --checkout
}

#@ install
function install_google_script () {
    #
    # @Description  install clasp with google script
    # @params       
    # @Example      install_google_script
    # @Reference    https://tech.arc-one.jp/gas-clasp
    #

    npm i @google/clasp -g
    npm install @types/google-apps-script
}

#@
function react_set () {
    #
    # @Description  make homepage by react framework
    # @params       
    # @Example      react_set
    # @Reference    chatgpt> I wanto make homepage by some framework, such as react, and vue.js.
    #

    #@ nest
    function create_react_app () {
        npx create-react-app $1
    }

    #@ nest
    function start_app () {
        npm start
    }

    local -a function_lst=(
        create_react_app
        start_app
    )
    local target_function=`array_fzf "${function_lst[*]}"`
    eval $target_function $@
}

#@
function vue_set () {
    #
    # @Description  make homepage by vue framework
    # @params       
    # @Example      vue_set
    # @Reference    chatgpt> I wanto make homepage by some framework, such as react, and vue.js.
    #

    #@ nest
    function create_vue_app () {
        vue create $1 $@
    }

    #@ nest
    function start_app () {
    }

    local -a function_lst=(
        create_vue_app
        start_app
    )
    local target_function=`array_fzf "${function_lst[*]}"`
}

#@ install $2
function install_gb_debugger () {
    #
    # @Description  install gb emulator for making it
    # @params       $1: install path
    #               $2: bin path
    # @Example      install_gb_debugger (install_path: $HOME/source/, bin_path:$HOME/bin)
    #               install_gb_debugger hoge geho
    # @Reference
    #

    
    local install_path=$1
    local bin_path=$2
    if [[ $# < 2 ]]; then
        install_path=$HOME/source
        bin_path=$HOME/bin
    fi

    cd $install_path
    wget https://github.com/LIJI32/SameBoy/releases/download/v0.16/sameboy_cocoa_v0.16.zip && unzip sameboy_cocoa_v0.16.zip
    ln -sf $PWD/SameBoy.app/Contents/MacOS/SameBoy $HOME/mywork/projects/gb_emulator/bin/

}

#@ $2 git
function _issue2pullrequest () {
    #
    # @Description  Work in progress about issue
    # @params       $1: issue_number
    #               $2: PR title
    # @Example      issue2pullrequest 44 fix bug about open window
    # @Reference    https://cli.github.com/manual/gh_pr_create
    #               https://cli.github.com/manual/gh_issue_develop
    #               ChatGPT: How to make pull request from issue with gh cli?
    #
    
    local issue_number=$1
    local issue_branch=`gh issue develop --list $issue_number | awk '{print $1}'`
    shift
    local title=$@
    local pr_info=`gh pr create -H $issue_branch -B dev --body "Fixes #$1" --title $title`
    local pr_number=`echo $pr_info | awk -F "/" '{print $(NF)}'`
    #gh pr checkout $pr_number
}

#@
function install_python_package () {
    #
    # torch torchvision torchaudio
    # opencv-python
    # scikit-learn scikit-image
    # pandas
    # numpy scipy
    # pytest
    #

}

#@ git
function issue2toDo () {
    #
    # @Description  issue list of all repositories
    # @params       
    # @Example      issuelst
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    local PROJECT_DIR=$HOME/mywork/projects
    local ISSUELST_PATH=/tmp/8ucchiman/all_issues
    if [[ -e $ISSUELST_PATH ]]; then
        rm $ISSUELST_PATH
    fi
    touch $ISSUELST_PATH
    for target_dir in `/bin/ls $PROJECT_DIR`; do
        cd $PROJECT_DIR/$target_dir

        if [[ -e .git ]]; then
            local remote_repository=`git config --get remote.origin.url`
            if [[ $remote_repository =~ "github" ]]; then
                local issues=("${(@f)$(gh issue list)}")
                #local issue_info=`gh issue create --title $title -F /tmp/8ucchiman/issues/${i}`
            else
                local issues=("${(@f)$(glab issue list)}")
                #local issue_info=`glab issue create -t "$title" -d "$description"`
            fi
            for issue in $issues; do
                echo "$PROJECT_DIR/$target_dir $issue" >> $ISSUELST_PATH
            done

            #gh issue list
        fi
    done
}

#@
function show_issuelst () {
    local ISSUELST_PATH=/tmp/8ucchiman/all_issues
    local issue_lst=`file_fzf $ISSUELST_PATH`
}

#@
function line_of_command2arr () {
    #
    # @Description  convert each line of command's output to array
    # @params       
    # @Example      line_of_command2arr
    # @Reference    https://qiita.com/kawaz/items/6e037631ca68d2dca13c
    #

    
}

#@ deploy
function deploy2script () {
    #
    # @Description  This is the deployment from functions of Bmods to shell script 
    # @params       
    # @Example      deploy2script
    # @Reference    
    #


}

##@
#function show_samples () {
#    #
#    # @Description  Show sample images, videos, gifs, or texts
#    # @params
#    # @Example      show_samples
#    # @Reference    
#    #
#
#    fuzzy_settings
#    $(cd $SAMPLE; fzf)
#    # echo $sample
#}

#@
function show_pics_preview () {
    
}


#@
function _show_sample_pics () {
    #
    # @Description  show sample pictures
    # @params       
    # @Example      show_sample_pics
    # @Reference    https://www.reddit.com/r/bash/comments/uxds93/add_image_preview_to_fzf/
    #

    
    local target_pics=$(cd $HOME/.config/sample/pics; /bin/ls | fzf --preview="
        if [[ {} =~ ('.jpg'|'.JPG'|'.jpeg'|'.png'|'.PNG')$ ]]; then
            catimg -r2 -w$COLUMNS {};
        elif [ -d {} ]; then
            /bin/ls --color=always --group-directories-first -H {};
        else
            nl -pba -w1 -s' ' {};
        fi")
}

#@ install
function install_catimg () {
    mkdir -p $HOME/source; cd $_
    git clone https://github.com/posva/catimg.git
    cd catimg
    cmake -S . -B build
    cd build
    maka install
    make
    ln -sf $PWD/bin/catimg $HOME/bin/
}


#@ install
function install_dust () {
    cargo install --locked du-dust
}

#@ install
function install_dropbox () {
    cd $HOME/bin/
    wget https://github.com/dropbox/dbxcli/releases/download/v3.0.0/dbxcli-linux-amd64
    mv dbxcli-linux-amd64 dbxcli
    chmod u+x dbxcli
}

#@ install repl rust
install_repl_rust () {
    cargo install evcxr_repl
}

#@ install
function install_google_cloud_cli () {
    sudo apt update
    sudo apt-get install -y apt-transport-https ca-certificates gnupg curl sudo
    echo "deb [signed-by=/usr/share/keyrings/cloud.google.asc] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
    sudo apt-get update && sudo apt-get install -y google-cloud-cli
    sudo apt-get install google-cloud-cli-app-engine-java
    gcloud init
}

##@
#function gpu_status () {
#    bus_id=(0 0)
#    #nvidia-smi --query-compute-apps=pid,gpu_bus_id,process_name --format=csv,noheader
#    empty_gpu=(`nvidia-smi --query-compute-apps=gpu_bus_id --format=csv,noheader`)
#
#    # echo "num: ${#empty_gpu[@]}"
#    if [[ ${#empty_gpu[@]} > 0 ]]; then
#        for eg in $empty_gpu; do
#            if [[ `echo $eg | grep 17` ]]; then
#                bus_id[1]=$(($bus_id[1]+1))
#            fi
#            if [[ `echo $eg | grep 65` ]]; then
#                bus_id[2]=$(($bus_id[2]+1))
#            fi
#        done
#    fi
#
#}

# for gpu detection
#
# date "+%Y_%m_%d_%H_%M"
# source /home/yk.iwabuchi/.zshrc
# base_path="/home/yk.iwabuchi/projects/RDC/confuciux/src/ConfX"
# out_dir="/home/yk.iwabuchi/projects/RDC/confuciux/outdir"
# conda activate confxEnvForce
# conda deactivate; conda activate confxEnvForce; rehash; which pip python
# bus_id=(0 0)
# #nvidia-smi --query-compute-apps=pid,gpu_bus_id,process_name --format=csv,noheader
# empty_gpu=(`nvidia-smi --query-compute-apps=gpu_bus_id --format=csv,noheader`)
# echo "num: ${#empty_gpu[@]}"
# if [[ ${#empty_gpu[@]} > 0 ]]
#   then
#   for eg in $empty_gpu
#   do
#     if [[ `echo $eg | grep 17` ]]
#     then
#       bus_id[1]=$(($bus_id[1]+1))
#     fi
#     if [[ `echo $eg | grep 65` ]]
#     then
#       bus_id[2]=$(($bus_id[2]+1))
#     fi
#   done
# fi
# 
# model="mobilenet_v2"
# #local -a FITNESS
# #local -a CSTR
# #local -a DATAFLOW
# FITNESS=(latency energy)
# CSTR=(area power)
# DATAFLOW=(shi dla eye dpt)
# 
# #if [[$bus_id[17] == 0 ]]
# #then
# #  export CUDA_VISIBLE_DEVICES="0"
# #fi
# if [[ $bus_id[2] < 3 ]]
# then
#   export CUDA_VISIBLE_DEVICES="1"
#   for fitness in $FITNESS
#   do
#     for cstr in $CSTR
#     do
#       for dataflow in $DATAFLOW
#       do
#         dir_name=${model}_F-${fitness}_C-${cstr}_Mul-0.5_DF-${dataflow}_RL_GA_D
#         if [[ -e ${out_dir}/${dir_name}/result.csv ]] && [[ ${bus_id[2]} < 3 ]]
#         then
#         else
#           cd $base_path
#           nohup python main.py --outdir outdir --model ${model} --fitness ${fitness} --cstr ${cstr} --mul 0.5 --epochs 500 --df ${dataflow} --alg RL_GA &
#           bus_id[2]=$(($bus_id[2]+1))
#         fi
#         echo "GPU0: $bus_id[1] GPU1: $bus_id[2]"
#         if [[ $bus_id[2] > 1 ]]
#         then
#           exit
#         fi
#       done
#     done
#   done
# else
#   echo "order"
# fi
# 
# return


# #@ $3
# function random_words2file () {
#     #
#     # @Description  create file with random words
#     # @params       $1: output file
#     #               $2: number of words
#     # @Example      random_words2file
#     # @Reference    
#     #
# 
#     local output_file=$1
#     if [[ $# < 2 ]]; then
#         output_file=random_words.txt
#     fi
#     touch $output_file
#     local -a random_words=(`random_words_generator $2`)
# }


#@ $1
function random_words_generator () {
    #
    # @Description  random words generator
    # @params       
    # @Example      random_words_generator 100
    # @Reference    https://linuxconfig.org/random-word-generator
    #

    local num_words=$1
    if [[ $# == 0 ]]; then
        num_words=`tr -dc 0-9 < /dev/urandom | fold -w 2 | head -1`
        num_words=$((num_words%20))
    fi
    #echo $num_words
 
    # Constants
    X=0
    ALL_NON_RANDOM_WORDS=/usr/share/dict/words
 
    # total number of non-random words available
    non_random_words=`cat $ALL_NON_RANDOM_WORDS | wc -l`
 
    # while loop to generate random words  
    # number of random generated words depends on supplied argument 
    while [[ $X -lt $num_words ]]; do
        random_number=`od -N3 -An -i /dev/urandom | awk -v f=0 -v r="$non_random_words" '{printf "%i\n", f + r * $num_words / 16777216}'`
        sed `echo $random_number`"q;d" $ALL_NON_RANDOM_WORDS
        let "X = X + 1"
    done
}

#@ wrapper install
function install_cargo () {
    #
    # @Description  install cargo, rust
    # @params       
    # @Example      install_cargo
    # @Keywords     wrapper
    #               install
    # @Reference    https://www.rust-lang.org/tools/install
    #

    install_rust
}

#@
function wsl_chrome_font_settings () {
    #
    # @Description  setup google chrome font in linux(wsl)
    # @params       
    # @Example      wsl_chrome_font_settings
    # @Reference    https://lef237.hatenablog.com/entry/2022/12/05/163550
    #

    sudo apt install -y language-pack-ja
    sudo apt install -y fonts-ipafont
    sudo apt install -y fonts-ipaexfont
    fc-cache -fv
}

#@ install
function install_starship () {
    #
    # @Description  install starship to set modern commandline
    # @params       
    # @Example      install_starship
    # @Reference    https://starship.rs/
    #

    cargo install starship --locked
}

#@ install
function install_hexyl () {
    #
    # @Description  hexyl, alternative to od
    # @params       
    # @Example      install_hexyl
    # @Reference    https://github.com/sharkdp/hexyl
    #

    cargo install hexyl
    # sudo apt install -y hexyl
    # sudo port install hexyl
}

#@ install
function install_broot () {
    #
    # @Description  alternative to tree
    # @params       
    # @Example      install_broot
    # @Reference    https://dystroy.org/broot/install/
    #
    
    # cd $HOME/bin
    # wget https://dystroy.org/broot/download/x86_64-linux/broot
    # chmod u+x broot
    cargo install --locked broot
}

#@ install
function install_exa () {
    #
    # @Description  alternative to ls
    # @params       
    # @Example      install_exa
    # @Reference    https://github.com/ogham/exa
    #

    cargo install --locked exa
}

#@ wsl
function recognize_usb_driver_in_wsl () {
    #
    # @Description  recognize usb driver in wsl
    # @params       
    # @Example      recognize_usb_driver_in_wsl
    # @Reference    https://qiita.com/KMNMKT/items/ae0e76a3e420b3ca16e6
    #               https://qiita.com/ryoma-jp/items/9db6cca5ed10f1aed7ff
    #               https://zenn.dev/fuyuaice/articles/930d41504818c6
    #               https://macha795.com/eset-ip-port-num-allow/
    #

    # on powershell
    winget install --interactive --exact dorssel.usbipd-win

    # on wsl
    sudo apt upgrade
    sudo apt update
    sudo apt install -y linux-tools-5.4.0-77-generic hwdata
    sudo update-alternatives --install /usr/local/bin/usbip usbip /usr/lib/linux-tools/5.4.0-77-generic/usbip 20

    # on powershell (admin)
    usbipd list
    usbipd bind -b 1-13
    usbipd attach --wsl --busid 1-13

}


#@
function yamaha_lua () {
    #
    # @Description  yamaha lua script
    # @params       yamaha_lua
    # @Example      yamaha_lua
    # @Reference    http://www.rtpro.yamaha.co.jp/RT/manual/rtx830/Users.pdf
    #               https://network.yamaha.com/setting/router_firewall/monitor/lua_script/manual
    #

    local -A description_search=(
        font    "console character en.ascii"
        copy    "copy usb1:/test.lua /test.lua"
        show    "show file list /"
        show_status "show status lan1"
        run     "lua usb1:/test.lua"
        set_ip  "ip lan1 address 192.168.6.199"
        set_ip_lan2 "ip lan2 address 192.168.6.198"
        set_ip_lan3 "ip lan3 address 192.168.6.197"
    )

    #@ nest
    function open_description () {
        nohup google-chrome http://www.rtpro.yamaha.co.jp/RT/manual/rtx830/Users.pdf &
    }

    local -a function_lst=(
        open_description
    )
    local target_func=`array_fzf "${function_lst[*]}"`
    eval $target_func
}


#@
function library_scratch () {
    #
    # @Description  install library, build, compile from scratch
    # @params       
    # @Example      library_scratch  glfw
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    
    mkdir -p $HOME/include
    mkdir -p $HOME/lib
    cd source

    #@ nest
    function glfw () {
        git clone https://github.com/glfw/glfw.git
        cd glfw;
        cmake -S . -B build
        ln -sf $PWD/include/GLFW $HOME/include/
        ln -sf $PWD/build/src/libglfw3.a $HOME/lib/
    }

    eval $@
}


#@ educ c
function c_lang {
#@ nest
function ar_static () {
    #
    # @Description  ar command (static maker)
    # @params       
    # @Example      ar_static
    # @Reference    https://linuxcommand.net/ar/
    #

    #@ nest
    function _r-option () {
        mkdir $TMP/ar_educ; cd $_;
cat <<eos > file1.c
#include<stdio.h>
void func1 (void) {
    printf("func1 is here\n");
}
eos
cat <<eos > file2.c
#include<stdio.h>
void func2 (void) {
    printf("func2 is here\n");
}
eos
cat <<eos > file3.c
#include<stdio.h>
void func3 (void) {
    printf("func3 is here\n");
}
eos
        gcc -c file1.c file2.c file3.c      # オプジェクトファイル作成
        ar r archive.a *.o                  # 静的ファイル追加
        ar t archive.a                      # 静的ライブラリ一覧表示
    }

    #@ nest
    function _d-option () {
        _r-option
        ar t archive.a
        ar d archive.a file2.o
        ar t archive.a
    }

    #@ nest
    function _t-option () {
        _r-option
        ar t archive.a
    }

    #@ nest
    function _x-option () {
        _r-option
        ar t archive.a
        ar x archive.a file1.o file2.o
        ls
    }

    #@ nest
    function _p-option () {
        echo "no description"
    }

    #@ nest
    function _s-option () {
        echo "no description"
    }

    #@ nest
    function _q-option () {
        _r-option
        ar t archive.a
cat <<eos > file4.c
#include<stdio.h>
void func4 (void) {
    printf("func4 is here!!\n");
}
eos
        ar q archive.a file4.o
    }

    #@ nest
    function _m-option () {
        _r-option
        ar t archive.a
        ar m archive.a file2.o
        ar t archive.a
    }

    #@ nest
    function clean () {
        rm -r $TMP/ar_educ
    }
}

#@ nest
function gcc_option () {
    function _I-option () {
        #
        # @Description  
        # @params       
        # @Example      _I-option
        # @Reference    https://qiita.com/DQNEO/items/4e5c2eca2761ec08b922
        #
        
        mkdir -p /tmp/8ucchiman/C/header; cd /tmp/8ucchiman/C;
cat <<eos > main.c
#include <stdio.h>
#include <bucchiman.h>

int main(int argc, char** argv) {
    print_all(argc, argv);
}
eos
        cd header;
cat <<eos > bucchiman.h
#include <stdio.h>

void print_all(int argc, char** argv) {
    for (int i=0; i<argc; i++) {
        printf("i: %d, arg: %s\n", i, argv[i]);
    }
}
eos
        cd ..
        gcc -I ./header main.c
        ./a.out bucchiman Bucchiman 8ucchiman
    }
}
}

#@
function mount_usb_from_native_to_wsl () {
    # echo "sudo mount -t drvfs $1: /mnt/${(L)1}"
    sudo mount -t drvfs $1: /mnt/${(L)1}
}

#@
function umount () {
    # sudo umount /mnt/d
}

#@
function memory_leak () {
    #
    # @Description  check memory leak
    # @params       
    # @Example      memory_leak
    # @Reference    chatgpt: How to detect memory leak in c language?
    #

    function sample () {
        mkdir -p /tmp/8ucchiman/memory_leak_test; cd $_
cat << EOF > memory_leak.c
#include <stdio.h>
#include <stdlib.h>


int main(void) {
    int *geho;
    geho = (int*) malloc(50*sizeof(int));
    // free(geho);
    return 0;
}
EOF
cat << EOF > no_memory_leak.c
#include <stdio.h>
#include <stdlib.h>


int main(void) {
    int *geho;
    geho = (int*) malloc(50*sizeof(int));
    free(geho);
    return 0;
}
EOF
        gcc -g -o memory_leak memory_leak.c
        gcc -g -o no_memory_leak no_memory_leak.c
        valgrind --leak-check=full ./memory_leak
        valgrind --leak-check=full ./no_memory_leak
    }

    function checker_code () {
        mkdir -p /tmp/8ucchiman/memory_leak_test; cd $_
cat << EOF > memchecker.c
#include <mcheck.h>
int main() {
    mtrace();
    // Your code here
    muntrace();
}
EOF
    }
    # sample
    # checker_code
}


##@ git
#function all_issues () {
#    #
#    # @Description  all issues from various repositories
#    # @params       
#    # @Example      all_issues
#    # @Reference    
#    #
#
#    while read target_repository; do
#        $(eval "cd $target_repository"; gh issue list | awk '{print $1, }' $target_repository)
#    done< <(cat /tmp/8ucchiman/target_repositories)
#
#
#}


#@ git
function lst2issues () {
    #
    # @Description  convert toDo list to issues
    # @params       
    # @Example      lst2issues
    # @Description  You have to prepare toDolst file in the current directory.
    # @Reference    https://qiita.com/takech9203/items/b96eff5773ce9d9cc9b3
    #               https://tech.kurojica.com/archives/25401/
    #               https://linux.just4fun.biz/?%E9%80%86%E5%BC%95%E3%81%8DUNIX%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89/%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E7%AF%84%E5%9B%B2%E3%81%AE%E8%A1%8C%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95
    #
    
    if [[ ! -e toDolst ]]; then
        echo "cannot find toDolst"
        exit 1
    fi
    # while read LINE; do
    #     # echo $LINE
    #     

    # done< <(cat toDolst)
    # awk '
    #     $0 ~ /^-+/  {print $2}
    #     $0 ~ /^[ ]+-+/  {print $2}
    # ' toDolst
    # awk "/i\/o/,/setup/" toDolst
    local -a num_lines=(`awk '
        $0 ~ /^-+/  {printf "%d ", NR}
        END{printf "%d\n", NR+1}
    ' toDolst`)
    # echo ${num_lines[*]}
    # echo ${#num_lines}
    mkdir -p /tmp/8ucchiman/issues
    for i in `seq -s " " $((${#num_lines}-1))`; do
        # echo $num_line
        cur_num_line=$num_lines[$i]
        next_num_line=$num_lines[$((i+1))]
        issue_check=`awk -v nr=${cur_num_line} 'NR==nr{print $(NF-1)}' toDolst`
        #echo $issue_check
        if [[ $issue_check == "issue:" ]]; then
            echo "issue already exists..."
            echo title ""
            echo issue is `awk -v nr=${cur_num_line} 'NR==nr{print $(NF)}' toDolst`
            rm -f /tmp/8ucchiman/issues/${i}
            continue
        fi
        sed -n "${cur_num_line},$((${next_num_line}-1))p" toDolst > /tmp/8ucchiman/issues/${i}

        local description=`sed -n "${cur_num_line},$((${next_num_line}-1))p" toDolst`
        # awk -v nr=${cur_num_line} 'NR=nr{print}' toDolst

        #local title=`sed -n "${cur_num_line}p" toDolst`
        local title=`awk -v nr=${cur_num_line} 'NR==nr{for(i=2; i<=NF; i++){printf("%s ", $i)}}' toDolst`

        local remote_repository=`git config --get remote.origin.url`
        if [[ $remote_repository =~ "github" ]]; then
            local issue_info=`gh issue create --title $title -F /tmp/8ucchiman/issues/${i}`
        elif [[ $remote_repository =~ "gitlab" ]]; then
            local issue_info=`glab issue create -t "$title" -d "$description"`
        else
            echo "cannot detect platform..."
            exit 1
        fi
        issue_number=`echo $issue_info | awk -F "/" '{print $(NF)}'`
        sed -i  -e "${cur_num_line} s/$/        issue: ${issue_number}/g" toDolst
        rm -f /tmp/8ucchiman/issues/${i}
    done
}

#@ $1 git
function append_issue () {
    #
    # @Description  append an issue (you have to make an issue with )
    # @params       $1: issue file
    # @Example      append_issue ./assets/append_01
    # @Reference    
    #

    # https://itneko.com/awk-print-index/
    #echo $@
    if [[ $# == 0 ]]; then
        echo "Need a toDo file as an argument."
        exit 1;
    fi
    local title=`awk 'NR==1{for(i=2;i<=NF;i++) printf"%s ", $i}END{printf "\n"}' $1`
    local remote_repository=`git config --get remote.origin.url`
    if [[ $remote_repository =~ "github" ]]; then
        local issue_info=`gh issue create --title $title -F ${1}`
        #rm -f /tmp/8ucchiman/issues/${i}
    elif [[ $remote_repository =~ "gitlab" ]]; then
        local issue_info=`glab issue create -t "$title" -d "$(cat $1)"`
    else
        echo "cannot detect platform..."
        exit 1
    fi
    issue_number=`echo $issue_info | awk -F "/" '{print $(NF)}'`
    sed -i  -e "1 s/$/        issue: ${issue_number}/g" $1
    cat $1 >> toDolst
    rm $1
}

#@
function systemd_cron () {
    #
    # @Description  create cron job on systemd
    # @params       
    # @Example      systemd_cron
    # @Reference    https://vlike-vlife.netlify.app/posts/systemd_scheduling
    #

    #@ nest
    function sample () {
        if [[ ! -L $HOME/.config/cron ]]; then
            cd $HOME/dotfiles;
            ./attach_dotfiles.zsh;
        fi
        cd $HOME/.config/cron
#cat << EOF > hello.sh
##!/bin/bash
#echo    "Hello, " "$@" "!"
#EOF
#        chmod u+x hello.sh

#        systemctl edit --user --force --full demo@.service
#        systemctl --user start demo@sample.servije
#        systemctl --user status demo@sample.service
    }
    # systemctl disable --user --now demo@schedule.timer
    # sample
}


#@ install
function install_system () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://installati.one/install-freeglut3-dev-ubuntu-20-04/#google_vignette
    #               https://utho.com/docs/tutorial/how-to-install-the-opengl-library-on-ubuntu-20-04/
    # 
    #

    
    local -a package_lst=(
        make
        cmake
        libglu1-mesa
        libxi-dev
        libxmu-dev
        libglu1-mesa-dev
        pkg-config
        freeglut3-dev       # lglut not found
        x11-apps
        mesa-utils
    )
    sudo apt-get install -y ${package_lst[*]}
}

#@
function docker () {
    #@ nest
    function sample () {
        mkdir -p /tmp/8ucchiman/test_docker; cd $_
cat << EOF > docker-compose.yml
web:
  build: .
  environment:
    DISABLE_SPRING: "1" 
    DB_USERNAME: "root"
    DB_PASSWORD: "root"
    DB_HOST: "db"
  ports:
    - "3000:3000"
  volumes:
    - ".:/var/local/rails5_product"
  links:
    - "db"

db:
  image: mysql:5.6
  environment:
    MYSQL_ROOT_PASSWORD: "root"
EOF

cat << EOF > Dockerfile
# rails5_product
FROM ruby:2.3.0
ENV LANG C.UTF-8

# Install Packages
RUN apt-get update -y && apt-get upgrade -y
RUN apt-get install -y \
      sudo \
      nodejs \
      build-essential \
      mysql-client 

# Application
ENV app     rails5_product
ENV deploy  /var/local/\$app
ENV user    prod_dev

# User
RUN useradd -d /home/\$user -m -s /bin/bash \$user
RUN echo "\$user:\$user" | chpasswd
RUN echo "\$user ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/\$user
USER \$user
ENV HOME /home/\$user

# Work Directory
RUN sudo mkdir -p \$deploy
RUN sudo chown -R \$user:\$user \$deploy
WORKDIR \$deploy

# Bundle Install
RUN sudo gem install bundler
# ADD Gemfile \$deploy/
# ADD Gemfile.lock \$deploy/
# RUN sudo chown \$user:\$user Gemfile
# RUN sudo chown \$user:\$user Gemfile.lock
# RUN bundle install

EXPOSE 3000
CMD ["./bin/rails", "server", "-b", "0.0.0.0"]
EOF
        docker-compose build
    }
    sample
}

#@ install repl c
function install_repl_c () {
    #
    # @Description  interactive mode cling
    # @params       
    # @Example      install_cling
    # @Reference    https://root.cern.ch/
    #               https://root.cern/cling/cling_build_instructions/
    #

    mkdir -p $HOME/source/cling; cd $_
    wget https://raw.github.com/Axel-Naumann/cling-all-in-one/master/clone.sh
    chmod u+x clone.sh
    ./clone.sh
    ln -sf $PWD/build/bin/cling $HOME/bin/cling
    ln -sf $PWD/build/bin/cling $HOME/bin/root
}

function init_wsl () {
    sudo apt update
    sudo apt upgrade
    sudo apt install -y xclip libssl-dev openssl evince
    

}

#@ install
function install_google_chrome () {
    sudo sh -c 'echo "deb http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
    sudo wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
    sudo apt update
    sudo apt-get install google-chrome-stable
}

function sick_sensor () {
    local -a sensor_lst=(
        wtt12l_b12547
        tim551_2050001
    )
    local -A datasheet(
        wtt12l_b12547       https://docs.rs-online.com/a533/A700000007638335.pdf
        tim551_2050001      https://docs.rs-online.com/513f/A700000007802452.pdf
    )
}

function add_metadata_to_image () {

}


function install_yq () {
    #
    # @Description  yaml cli install
    # @params       
    # @Example      install_yq
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    
    wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O $HOME/bin/yq
    chmod u+x $HOME/bin/yq
}

function sample01_yq () {

cat <<eos > sample01.yml
---
# A sample yaml file
company: spacelift
domain:
 - devops
 - devsecops
tutorial:
  - yaml:
      name: "YAML Ain't Markup Language"
      type: awesome
      born: 2001
  - json:
      name: JavaScript Object Notation
      type: great
      born: 2001
  - xml:
      name: Extensible Markup Language
      type: good
      born: 1996
author: omkarbirade
published: true
eos
}

function sample02_yq () {
    #
    # @Description  generate sample yaml file
    # @params       
    # @Example      sample02_yq
    # @Reference    https://zenn.dev/musyu/articles/a2ffd081b0eb077cf7b5
    #

cat <<eos > postgres-pod.yml
# postgres-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: postgres-pod
  labels:
    name: postgres-pod
    app: demo-app
spec:
  containers:
    - name: postgres
      image: postgres
      ports:
        - containerPort: 5432
      env:
        - name: POSTGRES_USER
          value: "postgres"
        - name: POSTGRES_PASSWORD
          value: "postgres"
eos
}



function pocket () {
    local -A reference_lst=(
        water_detection_satelight       https://towardsdatascience.com/water-detection-in-high-resolution-satellite-images-using-the-waterdetect-python-package-7c5a031e3d16
        wavelet_idea                    https://qiita.com/TumoiYorozu/items/a8193e5ecd957a1b9b0d
        wavelet_opencv                  https://qiita.com/stktk/items/c056ad72a8d9f9226c1f
        wavelet_intro                   https://scicoding.com/introduction-to-wavelet-transform-using-python/
        docker_port_forward             https://qiita.com/tatsuo-iriyama/items/e4bf2404411343116e3e
        mlflow_tips                     https://qiita.com/c60evaporator/items/e0eb1a0c521d1310d95d
        hyperopt                        https://qiita.com/kenchin110100/items/ac3edb480d789481f134
        vertexbuffer                    https://antongerdelan.net/opengl/vertexbuffers.html
        grid_block_thread               http://harmanani.github.io/classes/csc447/Notes/Lecture15.pdf
        opengl_tutorial                 https://www.opengl-tutorial.org/intermediate-tutorials/tutorial-10-transparency/
        3d_rendering                    https://zenn.dev/mebiusbox/articles/8e765148576919
        wakayama_opengl                 https://web.wakayama-u.ac.jp/~wuhy/08_3DCGwithGLUT.html
        awesome_opengl                  https://github.com/vtupulse/Computer-Graphics-Projects-in-OpenGL
        markov_processing               https://www.ma.noda.tus.ac.jp/u/sh/pdfdvi/10aa.pdf
        bandit_model                    https://www.ai-gakkai.or.jp/resource/my-bookmark/my-bookmark_vol31-no5/
        shadertoy                       https://www.shadertoy.com/browse
        shaderref                       https://qiita.com/guru_taka/items/28c7cd5db4ce3a3bf287
        reactthreefiber                 https://qiita.com/osakasho/items/c75d27e98aca9f4dc166
        glsl_dann                       https://qiita.com/doxas/items/5a7b6dedff4bc2ce1586
        hlsl                            https://github.com/Unity-Technologies/HLSLcc
        dynamic_library                 https://qiita.com/developer-kikikaikai/items/f6f87b2d1d7c3e14fb52#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AAlinux%E3%81%AE%E5%8B%95%E7%9A%84%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E4%BB%95%E7%B5%84%E3%81%BF
        network                         http://www.runsurunet.com/2017/10/13/%E5%88%A5%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9/
        neovim_plugin                   https://github.com/Olical/conjure
        network_commands                jetpack.io/devbox/docs/installing_devbox/
        mlflow-docker-compose           https://github.com/sachua/mlflow-docker-compose
        tokoilab                        https://marina.sys.wakayama-u.ac.jp/~tokoi/
        perlin_noise                    https://postd.cc/understanding-perlin-noise/
    )
    local target_=`array_fzf "${(k)reference_lst[*]}"`
    google-chrome $reference_lst[$target_]
}

function install_glab () {
    curl -L https://packages.gitlab.com/glab/glab/gpgkey | sudo apt-key add -
    cd /tmp/
    wget https://packages.gitlab.com/glab/glab/ubuntu/$(lsb_release -cs)/glab.list
    sudo mv /tmp/glab.list /etc/apt/sources.list.d/glab.list
    #sudo curl -o /etc/apt/sources.list.d/glab.list https://packages.gitlab.com/glab/glab/ubuntu/$(lsb_release -cs)/glab.list
    sudo apt update
    sudo apt install glab
}


#@ $1
function glab_create_branch_from_issue () {
    #
    # @Description  gitlab merge request
    # @params       $1: issue number
    # @Example      glab_create_branch_from_issue 6
    # @Reference    https://gitlab.com/gitlab-org/cli/-/blob/main/docs/source/mr/create.md
    #

    glab mr create -i $1
}

#@
function 8bit_assembler_simulator () {
    #
    # @Description  prepare for making 8bit assembler simulator
    # @params       
    # @Example      8bit_assembler_simulator
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    local -a reference_lst=(
        https://light11.hatenadiary.com/entry/2020/04/09/203510
        https://schweigi.github.io/assembler-simulator/
        https://schweigi.github.io/assembler-simulator/instruction-set.html
        https://www.mschweighauser.com/make-your-own-assembler-simulator-in-javascript-part1/
    )
}

#@
function pytorch_lib () {
    #
    # @Description  pytorch awesome libraries
    # @params       
    # @Example      pytorch_lib
    # @Reference    https://github.com/bharathgs/Awesome-pytorch-list
    #

    local -A lib_lst=(
        awesome     https://github.com/bharathgs/Awesome-pytorch-list
        pyro        https://github.com/pyro-ppl/pyro
        fastai      https://github.com/fastai/fastai
        raytune     xxxxxx
    )

    local -A tutorial_lst=(
        practical       https://github.com/spro/practical-pytorch
        nlp             https://pytorch.org/tutorials/beginner/deep_learning_nlp_tutorial.html
        pytorch_tuto    https://github.com/yunjey/pytorch-tutorial

    )

    local -A modelzoo_lst=(
        modelzoo        https://modelzoo.co/
    )

    local -A metrics_lst=(
        official        https://pytorch.org/serve/metrics.html

    )
}

#@
function install_firewalld () {
    #
    # @Description  install firewalld to set firewall
    # @params       
    # @Example      install_firewalld
    # @Reference    https://computingforgeeks.com/install-and-use-firewalld-on-ubuntu/
    #

    sudo apt update
    sudo apt install -y firewalld
    sudo systemctl enable firewalld
    sudo systemctl start firewalld
}

#@
function TauriDesktop () {
    #
    # @Description  install tauri (Desktop application)
    # @params       
    # @Example      install_tauri
    # @Reference    https://tauri.app/
    #

    #@ nest install
    function install_tauri () {
        cargo install create-tauri-app --locked
        cargo install trunk
    }

    #@ nest
    function run_tauri () {
        cargo tauri dev
    }

    #@ nest
    function create_tauri_app () {
        cargo create-tauri-app
    }

    #@ nest
    function _cargo () {
        cargo install create-tauri-app --locked
        cargo create-tauri-app
    }

    #@ nest
    function _shell () {
        sh <(curl https://create.tauri.app/sh)
    }

}

#@ install
function install_typescript () {
    npm install -g typescript
    npm install -g ts-node
}

function setup_deno () {
    #
    # @Description  deno setup
    # @params       
    # @Example      setup_deno
    # @Reference    https://deno-ja.vercel.app/manual@v1.9.1/getting_started/first_steps
    #

    #@ install
    function install_deno () {
        #
        # @Description  deno installer
        # @params       
        # @Example
        # @Reference    https://github.com/denoland/deno
        #

        curl -fsSL https://deno.land/install.sh | sh
    }

    #@
    function sample_deno () {
        deno run https://deno.land/std@0.94.0/examples/welcome.ts
    }
}



#@ mac
function MacSet () {
    #@ nest
    function mac_update () {
        sudo port selfupdate
    }

    #@ nest
    function mac_upgrade () {
        local target_package=packages=$(sudo port selfupdate && sudo port installed | fzf)
        # sudo port upgrade $target_package
    }
}

#@
function environment () {
    nvim --version
}


#@
function fork_repo () {
    local -a platforms=(
        github 
        gitlab
    )
    local target_platform=`array_fzf "${platforms[*]}"`
    echo -n "repository for fork...> "
    read repo
    if [[ $target_platform == "github" ]]; then
        gh repo fork $repo
    else
        glab repo fork $repo
    fi
}

#@
function website () {
    local -A reference_lst=(
        rust_web    https://zenn.dev/etoal83/articles/6eb6031865f3de
        elm         https://qiita.com/kazurego7/items/27a2b6f8b4a1bfac4bd3
        #reddit_info https://www.reddit.com/r/rust/comments/igrq90/comment/g2wkd17/?utm_source=share&utm_medium=web2x&context=3
    )
}

#@ 
function colorhex() {
    # https://askubuntu.com/questions/1405822/printf-statement-with-background-and-foreground-colours
    # printf '\033[41;32m%s\033[0m\n' foobar
    for color in {000..255}; do
        hex_color=`printf "%04x" $color`
        print -nP "%F{$color}$hex_color %f"
        if [ $(($((color-16))%6)) -eq 5 ]; then
            printf "\n"
        fi
    done

}


#@ idea
function gameboy_emulator () {
    local -A reference_lst=(
        keichi      https://keichi.dev/post/write-yourself-a-game-boy-emulator/
        ocaml       https://www.docswell.com/s/linoscope/ZNRRXL-game-boy-emulator-ocaml#p24
        go_01       https://hackmd.io/@anqou/HJcvRrwy9
        awesome     https://github.com/gbdev/awesome-gbdev#documentation
        go_02       https://zenn.dev/akatsuki/articles/ec95ab95f0e89ea8c38f
        rust        https://mjhd.hatenablog.com/entry/2021/04/14/221813
    )
}


#@
function colorlist () {
    for color in {000..015}; do
        print -nP "%F{$color}$color %f"
        print -nP "%K{$color}$color %k"
    done
    printf "\n"
    for color in {016..255}; do
        print -nP "%F{$color}$color %f"
        if [ $(($((color-16))%6)) -eq 5 ]; then
            printf "\n"
        fi
    done
}


#@ $1 git
function update_submodules () {
    #
    # @Description  update submodules
    # @params       $1: Directory
    # @Example
    # @Date         2023-11-09 11:49:01
    # @ToDo         if arguments
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    $(cd $1 && git submodule update --init --recursive)
}

#@
function network_projects () {
    local -A projects=(
    )
}


#@
function hotprojects () {
    #
    # @Description  hotprojects of repository, publickey1
    #               background command a
    #               foreground command b
    # @params       
    # @Example
    # @Reference    
    #

    #@ nest
    function reference_lst () {
        mojo                https://www.publickey1.jp/blog/23/wslpythonmojoastro_3020239.html
        wasm                https://zenn.dev/topics/wasm
        wasmer              https://www.publickey1.jp/blog/23/webassemblybashwasmer_40posixwasix.html
        technical_writing   https://qiita.com/yasuoyasuo/items/c43783316a4d141a140f
    }
    typeset -A platforms=(
        publickey1              https://www.publickey1.jp/
        most-repos              https://www.hostinger.com/tutorials/most-popular-github-repos
        codecamp                https://www.freecodecamp.org/news/the-most-popular-coding-challenge-websites/#7atcoder
        beecrowd                https://www.beecrowd.com.br/judge/en
        hackerrank              https://www.hackerrank.com/
    )

}
   

#@ $2
function Lremote_mount () {
    #
    # @Description  remote mount
    # @params       $1: remote server(remote path + remote directory)
    #                   e.g. bucchiman@hogemachine:mywork/project/fuga/mnt
    #               $2: host directory
    #                   e.g. $BASE_DIR/mnt
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    local remote_server=$1
    local host_dir=$2
    if [[ $# == 0 ]]; then
        echo -n "remote server(like \"bucchiman@hogemachine:mywork/project/fuga/mnt\")> "
        read remote_server
        echo -n "host directory(like \"\$BASE_DIR/mnt\")> "
        read host_dir
    fi
    
    sshfs -o follow_symlinks -o intr -o sshfs_sync \
             $remote_server \
             $host_dir
}

#@ educ lua reference
function lua_projects () {
    #
    # @Description  lua projects
    #               reference:  other projects
    #               idea:       my projects
    # @params       
    # @Example      lua_projects
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    #@ nest
    function reference () {
        typeset -A reference_lst=(
            apisix          https://github.com/apache/apisix
            kong            https://github.com/Kong/kong
        )
    }

    #@ nest
    function idea () {
        typeset -A idear_lst=(
        )
    }

}



#@ educ neovim reference
function neovim_projects () {
    #
    # @Description  neovim projects
    #               reference:  other projects
    #               idea:       my projects
    # @params       
    # @Example      neovim_projects
    # @Reference    
    #

    #@ nest
    function reference () {
        typeset -A reference_lst=(
            tetris001       https://www.rasukarusan.com/entry/2021/12/14/000000
            snow_like       https://qiita.com/kaitat/items/fe72c844e86abd030daa
            hightlight      https://ryota2357.com/blog/2023/neovim-custom-vim-ui-input/
            usefule_builtin https://qiita.com/jnchito/items/57ffda5712636a9a1e62
            colorscheme     https://blog.atusy.net/2022/04/28/vim-colorscheme-by-buffer/
            extmark         https://www.rasukarusan.com/entry/2021/08/22/202248
            play_neovim     https://www.rasukarusan.com/entry/2019/12/06/000000
        )
    }
}

#@
function install_gh () {
    mkdir -p $HOME/source; cd $_
    git clone https://github.com/cli/cli.git gh-cli
    cd gh-cli; mkdir -p bin
    make install prefix=$HOME/source/gh-cli/build
    ln -sf $PWD/build/bin/gh $HOME/bin/
}


#@
function gist () {
    gh gist list
}



#@ initialize
function starter_pack () {
    if ! _has starship ; then
        install_starship
    fi
    if ! _has fzf ; then
        install_fzf
    fi
    if ! _has bat ; then
        install_bat
    fi
    if ! _has delta; then
        install_delta
    fi
    if ! _has lazygit; then
        install_lazygit
    fi
}

#@
function install_delta () {
    #
    # @Description  success to diff
    # @params       
    # @Example      insatll_delta
    # @Reference    https://dandavison.github.io/delta/get-started.html
    #

    cargo install --locked git-delta
}


#@
function install_starship () {
    #
    # @Description  prompt decorator
    # @params       
    # @Example      install_starship
    # @Reference    https://starship.rs/
    #

    ## sudo
    # curl -sS https://starship.rs/install.sh | sh

    cargo install starship --locked
}


#@
function install_exa () {
    #
    # @Description  success to ls, with icon
    # @params       
    # @Example      install_exa
    # @Reference    https://github.com/ogham/exa
    #

    cargo install exa
}



## #@ lopez
## function temporal_fixed () {
##     sed 's/if \[ \$USE_WSL2 == 1 \]/if \[\[ \$USE_WSL2 == 1 \]\]/g' $HOME/bin/gulliver/dot.bashrc
## }

#@ install
function install_wasm () {
    #
    # @Description  wasm to install
    # @params       
    # @Example      install_wasm
    # @Date         2023-11-08 12:58:32
    # @Reference    https://rustwasm.github.io/wasm-pack/installer/
    #

    #@ nest
    function only4wsl2 () {
        curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
    }

    #@ nest
    function anyplatform () {
        cargo install wasm-pack
    }

    #@ nest
    function otherpm () {
        npm install -g wasm-pack
        # yarn global add wasm-pack
    }

    function_lst=(
        only4wsl2
        anyplatform
    )
    local target_func=`array_fzf "$function_lst[*]"`
    eval $target_func
}


#@ educ rust reference
function rust_projects () {
    function reference () {
        typeset -A reference_lst=(
            テトリス        https://zenn.dev/kumavale/books/30efec2e1d3428
            tetris002       https://qiita.com/namn1125/items/15ddea322c086aa1b0d3
            tetris003       https://speakerdeck.com/shunshobon/rustdedui-zhan-xing-tetriswozuo-tutahua?slide=22
            入門            https://zenn.dev/mebiusbox/books/22d4c1ed9b0003
            tauri           https://zenn.dev/kumassy/books/6e518fe09a86b2
            vulkan          https://zenn.dev/hatoo/books/52bcb9e9f7c87d
            async           https://zenn.dev/magurotuna/books/tokio-tutorial-ja
            official_docs   https://www.rust-lang.org/ja/
        )
        for key in ${(k)reference_lst}; do
            echo "$key\t\t$reference_lst[$key]"
        done
    }
    reference
}


#@ educ c#
function c#_projects () {
    function reference () {
        typeset -A reference_lst=(
            unity           https://zenn.dev/twugo/books/21cb3a6515e7b8
            wasm            https://zenn.dev/okazuki/books/aspnet-net-core-blazor-wasm
            C#              https://zenn.dev/oskgw_log/books/csharp-entrance
        )
        echo ${(kv)reference_lst}
    }
}

#@ educ cpp
function c++_projects () {
    function reference () {
        typeset -A reference_lst=(
            multithread     https://zenn.dev/yohhoy/books/cpp-stdlib-multithreading
            raytracing      https://zenn.dev/mebiusbox/books/8d9c42883df9f6
            vulkan          https://zenn.dev/nishiki/books/f468197dca2dd8
            micon           https://zenn.dev/yuina_blend/books/c-introduction
        )
        echo ${(kv)reference_lst}
    }
}


#@ educ diy
function diy_projects () {
    function reference () {
        typeset -A reference_lst=(
            pico_01         https://qiita.com/ochaochaocha3/items/1969d76debd6d3b42269
        )
        
    }
    
}

function install_nasm () {
    sudo apt install -y nasm
}


#@ educ reference
function machine_language () {
    #function reference () {
        local -A reference_lst=(
            シンボルテーブルについて    https://drumato.hatenablog.com/entry/2019/05/16/201234
            arコマンド解説              https://linuxcommand.net/ar/\#s
            cmakeの使い方               https://qiita.com/shohirose/items/45fb49c6b429e8b204ac
            ライブラリについて          https://qiita.com/false-git@github/items/4b531467788b446a18d2
            system_call01               https://research.miidas.jp/2019/05/macos%E3%81%AE%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%B3%E3%83%BC%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6/
            system_call02               https://qiita.com/m6m/items/295d1827f5f2a32a7bb1
            memory_leak                 https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/HighMemoryUsage/
            mac_repo_01                 https://github.com/below/HelloSilicon
            mac_repo_02                 https://github.com/Apress/Programming-with-64-Bit-ARM-Assembly-Language
            ctf                         https://kashiwaba-yuki.com/ctf-elf-training
            arm64                       https://modexp.wordpress.com/2018/10/30/arm64-assembly/
            mac_m1                      https://note.com/narikon/n/n714829b46475
            mercari                     https://engineering.mercari.com/en/blog/entry/20211129-compiling-for-ios-on-apple-m1/
            tsuda                       https://nw.tsuda.ac.jp/lec/arm64/mac_m1/
            tutorial                    https://www.section.io/engineering-education/assembly-part-1/
            tutorial_x86_64             https://github.com/mschwartz/assembly-tutorial
            nasm                        https://cs.lmu.edu/~ray/notes/nasmtutorial/
            exercises                   https://cs61.seas.harvard.edu/site/2020/AsmEx/
            z80_hello                   https://annpin.com/posts/18/03/06/hello-low-layer-programming/
            6502_hello                  https://euske.github.io/slides/asm6502/index.html
            6809_hello                  http://www.6809.net/6809/?6809%CC%BF%CE%E1%C9%BD
            68000_hello                 https://www.kkaneko.jp/pro/as/advanced/outline.html
            8086_hello                  http://software.aufheben.info/contents.html?contents_key=kouza_asm
        )
        #echo ${(kv)reference_lst}
        local target_url=`array_fzf "${(k)reference_lst[*]}"`
        nohup google-chrome ${reference_lst[$target_url]} &
    #}
    #reference
}




#@
function set_devcontainer () {
    #
    # @Description  set devcontainer
    # @params       
    # @Example
    # @Reference    
    #

    #@ nest
    function install_devcontainer () {
        npm install -g @devcontainers/cli
    }

    #@ nest
    function test () {
        git clone https://github.com/microsoft/vscode-remote-try-rust
        cd vscode-remote-try-rust/
        devcontainer up --workspace-folder .
    }
}

#@
function github_action () {
    #
    #
    #
    # Reference     https://qiita.com/vZke/items/868eb9fd5289d2a25660
    ###################################
    # Term
    #   workflow:
    #       parts:  trigger
    #               jobs
    #       what is:.github/worflows directory (define yaml)
    #
    #   event:
    #       trigger workflow
    #       outside event: webhook
    #
    #   jobs:
    #       sequence step
    #
    #   action:
    #       command
    #
    #   artifacts
    ###################################
    #
    #
}

#@ install
function install_lua () {
    mkdir -p $HOME/source && cd $_
    curl -R -O http://www.lua.org/ftp/lua-5.4.6.tar.gz
    tar zxf lua-5.4.6.tar.gz
    cd lua-5.4.6
    make all test
    cd src && ln -sf $PWD/lua $HOME/bin/
}

#@ error
function install_luarocks () {
    mkdir $HOME/source/luarocks && cd $_
    wget https://luarocks.org/releases/luarocks-3.9.2.tar.gz
    tar zxpf luarocks-3.9.2.tar.gz

}

#@ install
function install_lua () {
    #
    # @Description  install luarocks
    # @params       
    # @Example      install_luarocks
    # @Date         2023-11-02 11:24:28
    # @Reference    https://github.com/luarocks/luarocks/wiki/Download
    #

    #@ nest
    function test () {
        mkdir $TMP/lua_install_test && cd $_
        curl -R -O http://www.lua.org/ftp/lua-5.3.5.tar.gz
        tar -zxf lua-5.3.5.tar.gz
        cd lua-5.3.5
        sed -e "s/INSTALL_TOP= \/usr\/local/INSTALL_TOP= \$\(HOME\)\/source\/lua/" Makefile
    }

    #@ nest
    function run () {
        #cd $HOME/source
        mkdir $HOME/source/lua && cd $_
        curl -R -O http://www.lua.org/ftp/lua-5.3.5.tar.gz
        tar -zxf lua-5.3.5.tar.gz
        cd lua-5.3.5
        sed -i -e "s/INSTALL_TOP= \/usr\/local/INSTALL_TOP= \$\(HOME\)\/source\/lua/" Makefile
        make linux test
        make install
    }

    local -a function_lst=(
        test
        run
    )
    local target_function=`array_fzf "$function_lst[*]"`
    eval $target_function
}

#@ $1
function CurrentDirectory2Submodule () {
    #
    # @Description  directory to submodule
    # @params       
    # @Example      CurrentDirectory2Submodule
    # @Reference    https://day.marketing/blog/create-a-git-submodule-inside-an-existing-directory/
    #               https://blog.cloud-acct.com/posts/u-git-add-submodule/
    #

    # # local BASENAME=`basename $1`
    # # local remoterepo="git@github.com:Bucchiman/$BASENAME.git"
    # # gh repo create $BASENAME --private  # リモートリポジトリを作成 
    # # cd $1; git init
    # # git submodule add $remoterepo $BASENAME

    # local BASENAME=`basename $1`
    # local remoterepo="git@github.com:Bucchiman/$BASENAME.git"
    # gh repo create $BASENAME --private
    # git submodule add $remoterepo $1

    local -A platforms=(
        github      git@github.com:Bucchiman/
        gitlab      git@gitlab.com:Bucchiman/
    )
    target_platform=~`array_fzf "${(k)platforms[*]}"`

    # # vim .gitmodule
    # ## [submodule "path/to/submodule"]
    # ## path = path/to/submodule
    # ## url = git@github.com:user/submodule
    # ## 

    # git submodule add git@github.com:user/submodule.git submoduletmp
    # git submodule sync
    # git add .
    # git commit -m 'Initial commit of submodule'
    # git push origin master

    # cd path/to/submodule
    # # vim .gitignore
    # git add .
    # git commit -m 'Initial commit of submodule'
    # git remote add origin git@github.com:user/submodule.git
    # git push -u origin master
}

#@
function topleveldirectory () {
    #
    # @Description  toplevel directory
    # @params       
    # @Example      topleveldirectory $BASE_DIR
    # @Reference    
    #

    cd $1
}

#@
function install_distant () {
    mkdir -p $HOME/source/ && \
    git clone https://github.com/chipsenkbeil/distant.git && \
    cd distant && \
    cargo build --release && \
    ln -sf $PWD/target/release/distant $HOME/bin
}

#@ install
function install_nix () {
    _has cargo
}

#@
function set_devbox () {
    #
    # @Description  devbox setup
    # @params       
    # @Example      set_devbox
    # @Reference    https://www.nixhub.io/
    #


    #@ nest local
    function install_nix () {
        #
        # @Description  command a & command b
        #               background command a
        #               foreground command b
        # @params       : command a
        #               : command b
        # @Example
        # @Reference    https://github.com/nix-community/nix-user-chroot
        #               https://nixos.wiki/wiki/Nix_Installation_Guide
        #

        cargo install nix-user-chroot
        mkdir -m 0755 $HOME/bin/.nix
        nix-user-chroot $HOME/bin/.nix bash -c 'curl -L https://nixos.org/nix/install | sh'
        #nix-user-chroot ~/.nix bash
    }


    #@ nest sudo
    function install_devbox () {
        #
        # @Description  install devbox [sudo | local]
        # @params       
        # @Example      install_devbox
        # @Reference    https://www.jetpack.io/devbox/docs/installing_devbox/
        #

        curl -fsSL https://get.jetpack.io/devbox | bash
        # curl https://get.jetpack.io/devbox
    }

    #@ nest
    function base_packages () {
        devbox add zsh@latest                   # https://www.nixhub.io/packages/zsh
        devbox add neovim@latest                # https://www.nixhub.io/packages/neovim
        devbox add neovim-qt@latest             # https://www.nixhub.io/packages/neovim-qt
        devbox add neovim-gtk@latest            # https://www.nixhub.io/packages/neovim-gtk
        devbox add neovim-remote@latest         # https://www.nixhub.io/packages/neovim-remote
        devbox add git@latest                   # https://www.nixhub.io/packages/git
        # devbox add ripgrep
        devbox add fzf@latest                   # https://www.nixhub.io/packages/fzf
        devbox add gh@latest                    # https://www.nixhub.io/packages/gh
        devbox add bat@latest                   # https://www.nixhub.io/packages/bat
        devbox add glab@latest                  # https://www.nixhub.io/packages/glab
    }

    #@ nest
    function cpp_packages () {
        devbox add gcc@latest
        devbox add cmake@latest
        devbox add opencv@latest
    }

    #@ nest
    function python_packages () {
        devbox add python@312
        devbox add python312Packages.pip
    }

    #@ nest
    function cpp_packages () {
        devbox add opencv4@4.7.0
    }
    #@ nest
    function go_packages () {
        devbox add go
    }

    #@ nest
    function rust_packages () {
        devbox add rustc@latest
        devbox add rustup@latest
        devbox add rustus@latest
        devbox add rustcat@latest
        devbox add rustfmt@latest
    }

    #@ nest
    function create_workspace () {
        echo -n "Where is workspace? Please tell me path!!> "
        read workspace_path
        mkdir -p $workspace_path && cd $_
        devbox init;
        local -a packages=(
            base_packages
            python_packages
            rust_packages
            go_packages
            pass
        )
        local target_packages=`array_fzf "$packages[*]"`
        eval $target_packages
        devbox shell;
    }

    local -a function_lst=(
        install_nix
        install_devbox
        create_workspace
        pass
    )
    local target_functions=`array_fzf "$function_lst[*]"`
    eval $target_functions

}

#@ educ
function binary_hack () {
    #
    # @Description  
    # @params       
    # @Example      binary_hack
    # @Reference    https://qiita.com/rsooo/items/bb91071685f447ce29db
    #

    #@ nest
    function file_type () {
        file /bin/ls /bin/sh /var/log/messages  /dev/sda /dev/tty11 /tmp
    }

    #@ nest
    function extract_string_from_file () {
        strings /var/log/wtmp
    }

    #@ nest
    function edit_binary () {
        vim -b binfile
    }

    local dump4binary () {
        od -Ax -tx1z /var/log/wtmp
        hexdump -C /var/log/wtmp | head
        hexyl
        objdump
    }

    local function_lst=(
        file_type
        extract_string_from_file
    )

    local target_function=`array_fzf "$function_lst[*]"`
    eval "$target_function"
}


#@ educ
function create_c_library () {
    #
    # @Description  create c library
    # @params       
    # @Example      create_c_library
    # @Remarks      workspace is created in /tmp/8ucchiman directory
    # @Reference    https://sleepy-yoshi.hatenablog.com/entry/20090510/p1
    #

    local workspace="/tmp/8ucchiman/create_c_library"
    mkdir -p $workspace
    cd $workspace


    #@ nest
    function setup () {
        #
        # @ make
        #
cat << EOF > test.c
#include <stdio.h>
#include "test.h"

void print_hoge (int num) {
    int i;
    for (i = 0; i < num; i++) {
        printf("hoge\n");
    }
}
EOF
cat << EOF > test.h
#ifndef TEST_H
#define TEST_H

void print_hoge (int num);

#endif
EOF

cat << EOF > main.c
#include "test.h"

int
main (void) {
    print_hoge(5);
    return 0;
}
EOF
    }

    #@ nest
    function compile2libtest () {
        gcc -shared test.c -o libtest.so
    }

    #@ nest
    function compile2main () {
        gcc -I./ -L./ main.c -o main -ltest
    }

    #@ nest
    function main () {
        ./main
        ldd main            # check shared library of excutable file
    }

    setup
    compile2libtest
    compile2main
    main
}

#@
function setup_postfix () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    sudo apt update
    sudo apt install -y postfix
    # sudo cp /usr/share/postfix/main.cf.dist /etc/postfix/main.cf
    # sudo vi /etc/postfix/main.cf
}

#@ help
function help_rsync () {
    echo "-v | --verbose            動作内容を表示する "
    echo "-q | --quiet              動作中のメッセージを抑制する"
    echo "-n | --dry-run            試験モード。実際には動作せず、動作内容だけ表示する（「-v」や「--stats」を一緒に指定する）"
    echo "--stats                   ファイル数や転送サイズを表示する"
    echo "--list-only               コピーする代わりにファイルのリストを作成する"

    echo "-a | --archive            アーカイブモード（「-rlptgoD -no-H -no-A -no-X」相当）"
    echo "      -r | --recursive    ディレクトリを再帰的に処理する"
    echo "      -l | --links        シンボリックリンクをシンボリックリンクのままコピーする"
    echo "      -p | --perms        パーミッションを保持する"
    echo "      -t | --times        タイムスタンプを保持する"
    echo "      -g | --group        所有グループをそのまま保持する"
    echo "      -o | --owner        所有者をそのまま保持する（自分以外の所有者を保持するにはroot権限が必要）"
    echo "      -D                  デバイスファイルや特殊ファイルを保持する（「--devices --specials」相当）"
    echo "      --devices           デバイスファイルを保持する（root権限が必要）"
    echo "      --specials          特殊ファイルを保持する"

    echo "--no-オプション           指定したオプションを無効にする（「-H」を無効にする場合は「--no-H」のように指定する）"
    echo "-I | --ignore-times       サイズとタイムスタンプが同じファイルも処理する"
    echo "--size-only               サイズが同じファイルは処理しない"
    echo "-c | --checksum           更新日とサイズではなく、チェックサムで変更の有無をチェックする"
    echo "--daemon                  デーモンとして動作（「--daemon --help」でデーモン時に使用できるオプションが確認できる）"
}

#@ python
function instance_package () {
    pip install hydra-core --upgrade
    pip install -U "ray[data,train,tune,serve]"
    pip install async-timeout
    pip install hyperopt
    pip install torch torchvision torchaudio
    pip install scipy
    pip install scikit-learn
    pip install tensorboard
}

#@ 
function Mhoareyou () {
    #
    # @Description  machine description
    # @params       
    # @Example      
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    set DATE  = `date +%Y.%m.%d_%H:%M:%S`
set HERE = `pwd`

}


#@ python
function scraping_python () {
    #
    # @Description  scraping
    # @params       
    # @Example      scraping_python
    # @Reference    https://scrapy.org/
    #

    #@ nest
    function setup () {
        pip install requests scrapy selenium beautifulsoup4
    }

    #@ nest
    function run () {

    }

    #@ nest
    function test () {
        #
        # @Description  test sample
        # @params       
        # @Example
        # @Reference    https://qiita.com/D_U_8240/items/7ec882f8ba34c606a795
        #

        mkdir -p $TMP/scrapy_test && cd $_
        scrapy startproject sake
        #scrapy genspider <ファイル名> <スクレイピングしたいweb URL>
        cd sake && scrapy genspider scrapy_sake https://www.saketime.jp/ranking/
        cd $TMP/scrapy_test/sake && scrapy crawl scrapy_sake
    }

    #@ nest
    function clean () {
        rm -r $TMP/scrapy_test
    }

    local -a function_lst=(
        setup
        run
        test
        clean
    )
    local target_function=`array_fzf "$function_lst[*]"`
    eval $target_function
}

#@
function diff_checker () {
    #
    # @Description  rsync diff check
    # @params       
    # @Example      diff_checker /deploy/current /deploy/previous
    # @Remarks      for gulliver codes
    # @Reference    https://russt.me/2018/07/creating-and-applying-diffs-with-rsync/
    #

    local -a subcommands=(
        test
        run
        clean
        gulliver
    )
    local subcommand=`array_fzf "$subcommands[*]"`
    if [[ $subcommand == "run" ]]; then
        local A
        local B
        if [[ $# == 2 ]]; then
            A=$1
            B=$2
        else
            echo "You have to set two directories to compare each others."
            echo -n "A> "
            read A
            echo -n "B> "
            read B
        fi
        #rsync --write-batch=diff $1 $2
        #rsync --only-write-batch=diff $1 $2
        diff -rupN $A $B > diff.patch
    elif [[ $subcommand == "test" ]]; then
        mkdir -p $TMP/diff_checker_test && cd $_
        mkdir -p current && cd $_ && \
cat <<eos > calc.c
    #include <stdio.h>
    int add (int a, int b) {
        return a + b;
    }
    int sub (int a, int b) {
        return a - b;
    }
eos
cat <<eos > main.c
    #include <stdio.h>
    
    int main (void) {
        print("Hello world\n");
        return 0;
    }
eos
        mkdir -p doc/ && cd $_ && \
cat <<eos > doc.md
These contents will be written to the file.
        This line is indented.
8ucchiman was here!!
eos

        mkdir -p $TMP/diff_checker_test && cd $_
        mkdir -p previous && cd $_ && \
cat <<eos > calc.c
    #include <stdio.h>
    int add (int a, int b) {
        return a + b;
    }
eos
cat <<eos > main.c
    #include <stdio.h>
    
    int main (void) {
        print("Hello world\n");
        return 0;
    }
eos
        mkdir -p doc/ && cd $_ && \
cat <<eos > doc.md
These contents will be written to the file.
        This line is indented.
eos

        # cd $TMP/diff_checker_test && rsync --only-write-batch=diff current previous
        cd $TMP/diff_checker_test; diff -rupN current previous > test.patch; cat test.patch

    elif [[ $subcommand == "gulliver" ]]; then
        # rsync -aur $HOME/bin/gulliver /tmp/8ucchiman/gulliver
        #diff -rupN /tmp/gulliver_enviro/bin/gulliver $HOME/bin/gulliver    # > gulliver.patch; cat gulliver.patch
        diff -r /tmp/gulliver_enviro/bin/gulliver $HOME/bin/gulliver > gulliver.patch; cat gulliver.patch
    else
        rm -rf $TMP/diff_checker_test
    fi
}

#@ mac
function diskformat () {
    #
    # @Description  diskformat for exFat
    # @params       : command a
    #               : command b
    # @Example      diskformat
    # @Remarks      setting format in mac (for raspi), interactive mode
    # @Reference    https://qiita.com/rkonno/items/54b2e4b8770c8b0b2bcd
    #
    # @result       disutil list
    # /dev/disk0 (internal, physical):
    #    #:                       TYPE NAME                    SIZE       IDENTIFIER
    #    0:      GUID_partition_scheme                        *1.0 TB     disk0
    #    1:             Apple_APFS_ISC Container disk1         524.3 MB   disk0s1
    #    2:                 Apple_APFS Container disk3         994.7 GB   disk0s2
    #    3:        Apple_APFS_Recovery Container disk2         5.4 GB     disk0s3
    # 
    # /dev/disk3 (synthesized):
    #    #:                       TYPE NAME                    SIZE       IDENTIFIER
    #    0:      APFS Container Scheme -                      +994.7 GB   disk3
    #                                  Physical Store disk0s2
    #    1:                APFS Volume Macintosh HD            12.0 GB    disk3s1
    #    2:              APFS Snapshot com.apple.os.update-... 12.0 GB    disk3s1s1
    #    3:                APFS Volume Preboot                 9.9 GB     disk3s2
    #    4:                APFS Volume Recovery                1.7 GB     disk3s3
    #    5:                APFS Volume Data                    223.6 GB   disk3s5
    #    6:                APFS Volume VM                      20.5 KB    disk3s6
    # 
    # /dev/disk4 (external, physical):
    #    #:                       TYPE NAME                    SIZE       IDENTIFIER
    #    0:     FDisk_partition_scheme                        *120.0 GB   disk4
    #    1:               Windows_NTFS raspiHDD                115.0 GB   disk4s1       # <- target device
    #    2:                       0x12                         5.0 GB     disk4s2

    diskutil list
    echo -n "target identifier (like disk4s1) > "
    read identifier
    local -a formats=(
        ExFAT
        HFS+
        JHFS+
        APFS
        MS-DOS
        MBR
        GPT
    )

    echo -n "diskname? (like raspiHDD any string is OK.)> "
    read diskname
    local format=`array_fzf "${formats[*]}"`
    diskutil eraseDisk $format $diskname /dev/$identifier
}

#@ raspberry pi
function set_mount4raspi () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       
    # @Example      set_mount
    # @Remarks      interactive mode
    # @Reference    https://qiita.com/rkonno/items/54b2e4b8770c8b0b2bcd
    #               https://asithink001.blogspot.com/2013/05/exfat.html
    #
    # @Results      on `sudo blkid`
    # /dev/mmcblk0p1: LABEL_FATBOOT="boot" LABEL="boot" UUID="D386-9DE9" BLOCK_SIZE="512" TYPE="vfat" PARTUUID="ebbe9c69-01"
    # /dev/mmcblk0p2: LABEL="rootfs" UUID="996c1b5f-170b-4f38-a5e0-85eef5acf12c" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="ebbe9c69-02"
    # /dev/loop0: TYPE="squashfs"
    # /dev/loop1: TYPE="squashfs"
    # /dev/loop2: TYPE="squashfs"
    # /dev/loop3: TYPE="squashfs"
    # /dev/loop4: TYPE="squashfs"
    # /dev/loop5: TYPE="squashfs"
    # /dev/loop6: TYPE="squashfs"
    # /dev/loop7: TYPE="squashfs"
    # /dev/loop8: TYPE="squashfs"
    # /dev/sda1: LABEL="raspiHDD" UUID="653F-973F" BLOCK_SIZE="512" TYPE="exfat" PARTUUID="9bdbf079-01"         # target device
    # /dev/sda2: LABEL_FATBOOT="SERVICEV001" LABEL="SERVICEV001" UUID="3011-EE06" BLOCK_SIZE="512" TYPE="vfat" PARTUUID="9bdbf079-02"
    #
    # @Results      on `sudo vim /etc/fstab`
    # proc            /proc           proc    defaults          0       0
    # /dev/mmcblk0p6  /boot           vfat    defaults          0       2
    # /dev/mmcblk0p7  /               ext4    defaults,noatime  0       1
    # UUID="653F-973F"        /mnt/raspiHDD    exfat-fuse      async,auto,dev,exec,gid=65534,rw,uid=65534,umask=007    0       0
    # ---------------         -------------    ----------      ----------------------------------------------------
    #   device                 mount point     file system          mount option
    #

    sudo apt-get install exfat-fuse exfat-utils
    sudo blkid
    echo -n "You have to remember UUID. Do you remember that? [Enter]"
    read dummy
    echo -n "open fstab, to use UUID."
    sleep 3
    sudo vim /etc/fstab
}

#@ raspberry pi
function change_hostname () {
    #
    # @Description  change hostname 
    # @params       
    # @Example      change_hostname
    # @Remarks      2023-10-30 21:57:39
    #                   raspberrypi ->  raspi
    #                   
    # @Reference    https://qiita.com/rkonno/items/54b2e4b8770c8b0b2bcd
    #

    sudo vim /etc/hostname
    sudo vim /etc/hosts
    
}

#@
function _check_file_exist () {
    # https://tanakatarou.tech/1699/
    [ -e $1 ]; echo $?; # or [ -a file ];
}

#@ archive
function _has () {
    return $( whence $1 &>/dev/null )
}

#@
function _git_config () {
    git config --local user.name "8ucchiman"
    git config --local user.email "8ucchiman@gmail.com"
}

#@
function install_lazygit () {
    #
    # @Description  lazygit install (Ubuntu)
    # @params       
    # @Example      install_lazygit
    # @Reference    https://github.com/jesseduffield/lazygit/issues/1460
    #

    if ! _has go; then
        install_go
    fi
    # go install github.com/jesseduffield/lazygit@leighmcculloch
    go install github.com/jesseduffield/lazygit@latest
    # sudo snap install core
    # sudo snap install lazygit-gm
}

#@ install
function install_language () {
    #
    # @Description  install rust
    # @params       
    # @Example      install_rust
    # @Reference    
    #

    #local -a langs=( rust go )
    #if [[  ]]; then
    #    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    #fi
}

#@ install
function install_rust () {
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
}

#@ install
function install_modular () {
    #
    # @Description  modular mojo install
    # @params       
    # @Example      install_modular
    # @Reference    https://developer.modular.com/download
    #
    
    sudo apt-get update && \
    sudo apt-get install modular && \
    modular clean && \
    modular install mojo
}

#@ install
function install_go () {
    #
    # @Description  go install
    # @params       
    # @Example      install_go
    # @Reference    
    #

    cd $HOME/source
    if [[ ! -e go1.21.3.linux-arm64.tar.gz ]]; then
        #wget https://go.dev/dl/go1.21.3.linux-arm64.tar.gz
        wget https://go.dev/dl/go1.21.3.linux-amd64.tar.gz
        #rm -rf $HOME/source/go && tar -C $HOME/source/ -xzf go1.21.3.linux-arm64.tar.gz
    fi
    # for amd64
    if [[ ! -e https://go.dev/dl/go1.21.3.linux-amd64.tar.gz ]]; then
        wget https://go.dev/dl/go1.21.3.linux-amd64.tar.gz
        rm -rf $HOME/source/go && tar -C $HOME/source/ -xzf go1.21.3.linux-amd64.tar.gz
    fi

    # for arm 
    # if [[ ! -e go1.21.3.linux-arm64.tar.gz ]]; then
    #     wget https://go.dev/dl/go1.21.3.linux-arm64.tar.gz
    #     rm -rf $HOME/source/go && tar -C $HOME/source/ -xzf go1.21.3.linux-arm64.tar.gz
    # fi
    ln -sf $PWD/go/bin/go $HOME/bin/
}

#@ install arguments $1
function setup_nodejs () {
    #
    # @Description  nodejs modules
    # @params       $1: nest function
    # @Example      setup_nodejs install_fnm
    # @Reference    
    #

    #@ nest
    function install_fnm () {
        #
        # @Description  fnm nodejs package manager
        # @params       
        # @Example      
        # @Reference    
        #

        cargo install fnm
        fnm install --lts
    }
    eval $@
}

#@ raspi_pico
function pico_environment () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/ochaochaocha3/items/1969d76debd6d3b42269
    #

    
    rustup target install thumbv6m-none-eabi
    cargo install flip-link                     # 組込みプログラム実行時のスタックオーバーフローを防止するため、リンク時にメモリ配置を変更するツール
    cargo install elf2uf2-rs                    # ビルドしたプログラムをUF2というPicoに書き込める形式に変換するツール
    cargo install cargo-generate
}

#@ $1
function ls_all_files () {
    #
    # @Description  ls all files with recursively directories
    # @params       $1: target directory
    #
    # @Example      $ Bmods ls_all_files $HOME/bin/gulliver
    #               > 
    #               >
    #               >
    #               >
    ls -l --color=auto -d `find $1`
    # ls -ld --color=auto $(find $HOME/bin/gulliver)
    # ls -ld --color=auto `find $HOME/bin/gulliver`
}

#@ $2
function background_one_foreground_the_other () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       $1: command a
    #               $2: command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #
    $1 & $2
}

#@ $2
function order_concat_commands () {
    #
    # @Description  command a && command b
    #               run command a, if error, next command b is not running
    #               command b
    # @params       $1: command a
    #               $2: command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #
    $1 && $2
}

#@ $2
function reorder_concat_commands () {
    #
    # @Description  command a || command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #
    $1 || $2
}

#@ $2
function update_check () {
    #
    # @Description  command a || command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #
}

#@ $1
function make_shared_library () {
    #
    # @Description  make shared library
    # @params       $1: file name (without extension)
    # @Example      make_shared_library sub
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    gcc -maix64 -fpic -c $1.c
    gcc -maix64 -shared -o lib$1.so $1.o
}


#@
function zsh_lovers () {

    local -A reference_lst=(
        modifier        https://wonderwall.hatenablog.com/entry/2016/06/19/154205
    )
}


#@ $1
function youare... () {
    echo "you are ..."
    echo "$1"
}

#@ install
function install_neovim () {
    #
    # @Description  install neovim (more latest version)
    # @params       
    # @Example
    # @Remarks      apt package manager has old version neovim
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    cd $HOME/source/
    wget https://github.com/neovim/neovim/releases/download/nightly/nvim-linux64.tar.gz
    tar xzvf nvim-linux64.tar.gz
    ln -sf $PWD/nvim-linux64/bin/nvim $HOME/bin/nvim
    # sudo apt install -y snapd
    # sudo snap install --classic nvim
    # git clone https://github.com/neovim/neovim.git $HOME/source/neovim
    # cd $HOME/source/neovim
    # make CMAKE_BUILD_TYPE=RelWithDebInfo
    # sudo make install
}

#@ 
function _touch_local () {
    #
    # @Description  local config
    # @params       
    # @Example      _touch_local
    # @Reference    
    #

    mkdir -p $HOME/.config/local
    touch $HOME/.config/local/hotstation $HOME/.config/local/local.zsh
}

#@ install
function install_wokwi () {
    #
    # @Description  wokwi cli
    # @params       
    # @Example      wokwi install
    # @Remarks      token has to be prepared(https://wokwi.com/dashboard/ci).
    # @Reference    https://github.com/wokwi/wokwi-cli
    #               https://wokwi.com/dashboard/ci
    #

    curl -L https://wokwi.com/ci/install.sh | sh
}

#@ raspi
function settings_samba () {
    #
    # @Description  samba install
    # @params       
    # @Example
    # @Remarks      for raspberry pi 
    # @Reference    https://child-programmer.com/rp-shared-folder-m/
    #

    ####################
    #   raspberry pi settings
    ####################
    sudo apt update;
    sudo apt upgrade;
    sudo apt install -y samba samba-common-bin
    sudo nano /etc/samba/smb.conf /etc/samba/smb.conf_backupdata

    # [pi]                                  # 共有フォルダの名前
    # comment = RaspberryPi-shared-folder   # コメント自由記述
    # path = /home/bucchiman/               # 共有フォルダのパスを指定する
    # guest ok = no                         # ゲストアカウント（パスワード不要）で接続を許可するかどうか。
    # read only = no                        # 読み取り専用かどうか。書き込みもしたい場合は、no
    # force user = pi                       # ファイル操作を、ユーザー「pi」 によって実行。

    sudo smbpasswd -a bucchiman   # set password
    sudo systemctl restart smbd
    sudo systemctl status smbd

    ###################
    #   mac
    ###################
    # finder - move - connect server
    # smb://raspberrypi (smb://[ip address/domain name])

}

#@ raspi
function setup_raspberrypi4 () {
    #
    # @Description  setup raspberry pi 4
    # @params       
    # @Example      
    # @Reference    
    #

    sudo apt-get install -y fuse
}

#@ example
function _example_wokwi () {
    #
    # @Description  example esp32
    # @params       
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    git clone https://github.com/wokwi/esp-idf-hello-world
    cd esp-idf-hello-world
    wokwi-cli .
}

#@ $2 install
function install_fzf () {
    #
    # @Description  install fzf for local user
    # @params       $1: install path
    #               $2: bin path
    # @Example      install_fzf
    #               install_fzf $PWD $PWD/bin
    # @Reference    https://github.com/junegunn/fzf#installation
    #

    local install_path=$1
    local bin_path=$2
    if [[ $# < 2 ]]; then
        mkdir -p $HOME/source
        install_path=$HOME/source/fzf
        bin_path=$HOME/bin/fzf
    fi

    git clone --depth 1 https://github.com/junegunn/fzf.git $install_path
    $install_path/install
    ln -sf $install_path/bin/fzf $bin_path
}

#@ install
function install_bat () {
    #
    # @Description  success to cat, useful with syntax hightlight et al...
    # @params       
    # @Example      install_bat
    # @Reference    https://github.com/sharkdp/bat
    #

    cargo install --locked bat
}

#@
function _attach_dotfiles () {
    #
    # @Description  attach dotfiles (for only 8ucchiman)
    # @params
    # @Example      attach_dotfiles
    # @Remarks      dotfiles: git@github.com:Bucchiman/dotfiles.git
    # @Reference
    #

    git clone --recursive git@github.com:Bucchiman/dotfiles.git $HOME/dotfiles
}

#@
function switch_dev () {

}

#@ archive
function array_fzf () {
    #
    # @Description  array_fzf
    # @params       $1: array
    #               $2: preview
    # @Example      local reults=`array_fzf "${platform[*]}"`
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    local array=($(echo $1))
    echo $(printf '%s\n' "${array[@]}" | fzf --preview="$2" --preview-label='' --height 100% )
}

#@ archive
function file_fzf () {
    #
    # @Description  itemize file fzf
    # @params       $1: file
    # @Example      file_fzf local_commands_history
    # @Reference    
    #

    echo $(/bin/cat $1 | fzf --height 100% )
}

#@ archive
function ls_fzf () {
    #
    # @Description  ls fzf
    # @params       $1: any path
    # @Example      ls_fzf $HOME/mywork/projects
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #
    echo $(/bin/ls -1 $1 | fzf --height 100%)
}

# function function_lst () {
#     #
#     # @Description  awk pattern with variable
#     # @params       : command a
#     #               : command b
#     # @Example
#     #
#     # @Reference    https://stackoverflow.com/questions/39384283/how-to-match-a-pattern-given-in-a-variable-in-awk
#     #               https://www.rasukarusan.com/entry/2019/04/30/000000
#     #
# 
#     file=$1
#     function_lst=($(awk -v pattern=$2 '$0 ~ pattern' $file))
# }
# 
# function func_lst() {
#     #
#     # @Description  command a & command b
#     #               background command a
#     #               foreground command b
#     # @params       : command a
#     #               : command b
#     # @Example
#     # @Reference: https://www.rasukarusan.com/entry/2019/04/30/000000
#     #
# 
#     local func=$(
#        typeset -f \
#        | grep ".*() {$" \
#        | grep "^[a-z_]" \
#        | tr -d "() {"   \
#        | fzf --height 100% --preview "source ~/Bmods; typeset -f  {}"
#    )
#     if [ -z "$func" ]; then
#         return
#     fi
#     typeset -f $func
# }

#@
function get_function_lst () {
    #
    # @Description  Get function list of a shell script
    # @params       $1: Directory
    # @Example      function_lst=`get_function_lst $HOME/Bmods`
    # @Remarks      hit ONLY "function" keywords
    # @Reference    
    #

    local function_lst=($(awk '/^function/{print $2}' $1))
    echo $function_lst
    #local target_function=`array_fzf "${function_lst[*]}" "cat $HOME/"`
    # local target_function=`printf '%s\n' "${function_lst[@]}" | fzf --preview-label="howto" --preview='grep -A 6 {} $HOME/Bmods' --height 100%`
    # eval "${target_function}"
}

#@
function get_target_function () {
    #
    # @Description  Get target function from function list
    # @params       $1: function list
    #               $2: script file
    # @Example      target_function=`get_target_function ${function_lst[*]}`
    # @Reference
    #
    local function_lst=($(echo $1))
    #echo "function_lst: $function_lst"
    #echo "script file:  $2"
    local target_function=`printf '%s\n' "${function_lst[@]}" | fzf --preview-label="howto" --preview="grep -B 1 -A 20 {} $2" --height 100%`
    echo $target_function

}

#@
function choose_local_function () {
    #
    # @Description  choose target function from local script
    # @params       $1: script file
    # @Example      local target_function=`choose_local_function $BASE_DIR/$0`
    # @Reference
    #

    local function_lst=`get_function_lst $1`
    local target_function=`get_target_function $function_lst[*] $1`
    echo $target_function
}

#@
function choose_Bmods_function () {
    #
    # @Description  choose target function from Bmods
    # @params       
    # @Example      local target_function=`choose_Bmods_function`
    # @Reference
    #

    local function_lst=`get_function_lst $HOME/Bmods`
    local target_function=`get_target_function $function_lst[*] $HOME/Bmods`
    echo $target_function
}

#@
function echo_Bmods_function_lst () {
    #
    # @Description  print function list of Bmods (for mainly debug)
    # @params       
    # @Example      echo_Bmods_function_list
    # @Remarks      hit ONLY "function" keyword
    # @Reference
    #
    awk '/^function/{print $2}' $HOME/Bmods
}


typeset -a MODULE_lst
typeset -A DOTFILES_SUBMODULES
typeset -A MYWORK_lst
#@
function set_variables () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    
    #

    echo "******************************"
    echo "* set_variables              *"
    echo "******************************"
    BASE_DIR=$PWD
    DOTFILES=$HOME/dotfiles/
    SAMPLE=$HOME/.config/sample/
    TMP=/tmp/8ucchiman/
    BMODS_PATH=$HOME/Bmods
    machine=`uname -s`
    # Reference: https://qiita.com/ttakuya50/items/085bea9176006016e593
    # MODULE_lst=(
    #     _debug
    #     fuzzy_settings
    #     default
    #     show_cmd_history
    #     load_local
    #     specific_scripts_function_lst
    # )
    #MODULE_lst = make_function_lst $HOME/gmods function zsh
    DOTFILES_SUBMODULES=(
        onelines            .config/lib/onelines
        csharp              .config/lib/codes/csharp
        c                   .config/lib/codes/c
        cpp                 .config/lib/codes/c++
        rust                .config/lib/codes/rust
        python              .config/lib/codes/python
        assembler           .config/lib/codes/assembler
        lua                 .config/lib/codes/lua
        cuda                .config/lib/codes/cuda
        IoT                 .config/lib/codes/IoT
        shell               .config/lib/codes/shell
    )
    # for value in ${(v)DOTFILES_SUBMODULES}; do
    #     echo $value
    # done
    # MYWORK_lst=(
    #     slam                # path
    #     maestro             # path
    #     speedestimation     # path
    # )
}

#@
function attach_mywork () {
    #
    # @Description  clone myworks (for only 8ucchiman)
    # @params       
    # @Example      attach_mywork
    # @Remarks      git@gitlab.com:8ucchiman/mywork.git
    # @Reference    
    #

    if [[ $# == 0 ]]; then
        download_place=$HOME
    else
        download_place=$1
    fi
    $(cd $download_place; git clone --recursive git@gitlab.com:8ucchiman/mywork.git)
}

#@
function run_mywork () {
    #
    # @Description  mywork projects running
    # @params       
    # @Example      run_mywork
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    $(cd $HOME/mywork; ./Brun Lchoose_project)
}

#@
function mywork_menue () {
    cd $HOME/mywork; ./Brun
}


#@
function setup_environment () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    # ln -sf $HOME/dotfiles/.config/pockets/shell/Bmods Bmods
}

#@ archive
function _debug () {
    #
    # @Description  Check Bmods path!!!
    # @params       
    # @Example
    # @Reference    
    #

    echo "8ucchiman was here!!"
}

#@ $1
function add_submodules () {
    #
    # @Description  Add submodules for main repository
    # @params       $1: repository url
    # @Example
    # @Reference    
    #

    git submodule add $1
}


#@
function show_cmd_history () {
    #
    # @Description  show .zhistory
    # @params       
    # @Example      show_cmd_history
    # @Reference    
    #

    file_fzf $HOME/.zhistory
}

#@
function run_submodule () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #


    #
    # toDo!!!!!!!!! my work
    #
    local target_submodule=`ls_fzf `
}

#@
function run_python () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #


    #
    # toDo!!!!!!!!! my work
    #
    #
   
}

#@
function run_c () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #



    #
    # toDo!!!!!!!!! my work
    #
    #
   
}

#@
function run_cpp () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #



    #
    # toDo!!!!!!!!! my work
    #
    #

}

#@
function run_rust () {


    #
    # toDo!!!!!!!!! my work
    #
    #

}

#@
function run_csharp () {
    #
    # toDo!!!!!!!!! my work
    #
    #

}

#@
function run_csharp () {
    #
    # toDo!!!!!!!!! my work
    #
    #

}

#@
function update_dotfiles () {
    #
    # @Description  update dotfiles
    # @params       
    # @Example      update_dotfiles
    # @Reference    
    #


    cd $DOTFILES
    git fetch origin dev
    git merge origin/dev
    for value in ${(v)DOTFILES_SUBMODULES}; do
        cd $DOTFILES/$value
        git fetch origin dev
        git merge --no-edit origin/dev
    done
    source $HOME/.zshrc
}

#@
function gulliver_code_rsync () {
}

#@
function _load_mywork_submodules () {
    
}

#@
function fuzzy_settings () {
    #---------------#
    #   fzf & ag    #
    #---------------#
    # fzf から the_silver_searcher (ag) を呼び出すことで高速化
    # fzf の キーバインド
    #if [ -e /opt/local/share/fzf/shell/key-bindings.zsh ]; then
    #    source /opt/local/share/fzf/shell/key-bindings.zsh
    #fi
    
    if [ -e $HOME/.fzf/shell/completion.zsh ]; then
        source $HOME/.fzf/shell/completion.zsh
    fi
    
    # fzf の 補完設定
    #if [ -e /opt/local/share/fzf/shell/completion.zsh ]; then
    #    source /opt/local/share/fzf/shell/completion.zsh
    #fi
    
    if _has fzf && _has ag; then
        export FZF_DEFAULT_COMMAND='ag --nocolor -g ""'
        export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
        export FZF_ALT_C_COMMAND="$FZF_DEFAULT_COMMAND"
        export FZF_COMMON_MYOPTS="--height 40% --layout=reverse --multi"
        export FZF_DEFAULT_OPTS="$FZF_COMMON_MYOPTS" # --preview 'bat --color=always {} --style=plain'"
        export FZF_CTRL_T_OPTS="$FZF_COMMON_MYOPTS" # --bind 'ctrl-y:execute-silent(echo {} | pbcopy)+abort' --border --preview 'bat --color=always {}'"
    fi

}

#@
function load_local () {
    #
    # TL;DR:        load local a file.zsh
    #
    #
    yn=`check_file_exist $1`
    if [[ $yn == "y" ]]; then
        source $1
    else
        echo "not exist local file"
    fi
}

#@
function font_settings () {
    #
    # show config?
    #     $ cat /etc/fonts/fonts.conf
    #
    # Reference: https://zenn.dev/hanaasagi/articles/9e428f0c9594a6
    #
    if [[ -e $HOME/.fonts ]]; then

    else
        ln -sf $HOME/dotfiles/.config/fonts $HOME/.fonts
    fi
    fc-cache -f -v
}

#@
function link_all () {
    #
    # @Description  link all files at one time
    # @params       $1: pattern
    # @return 
    # @Example      link_all $HOME/source/go/bin
    # Reference:    https://qiita.com/real_yaruo/items/0a1b4a88cfd5f27f062d
    #

    ls $1 | xargs -I{} ln -s {} {}
}

#@
function anaconda () {
}

#@
function clone_testrepository () {
    $(cd $TMP; git clone git@github.com:Bucchiman/test.git)
    #git clone https://github.com/Bucchiman/test.git
}

#@ $1
function what_file_is_this () {
    #
    # @Description  show file infomation
    # @params       $1: file
    # @Example      what_file_is_this hoge.png
    # @Reference    https://kodekloud.com/blog/file-creation-time-linux/
    #

    if [[ $# == 0 ]]; then
        echo "You have to specify the file as an argument..."
    fi
    local target=$1
    local full_file_path=${target:a}
    local base_name=${target:r}
    local extension=${target:e}
    local own_user=`stat -c "%U:%u" $1`
    local own_group=`stat -c "%G:%g" $1`
    local access_mode=`stat -c "%A" $1`
    local create_date=`stat -c "%w" $1`
    local acccess_date=`stat -c "%x" $1`
    local modify_date=`stat -c "%z" $1`
    local change_date=`stat -c "%y" $1`

    local -A metadata
    if [[ $extension == "png" || $extension == "jpg" ]]; then
        metadata["size"]=`identify -format "%[size]" $1`
        metadata["width"]=`identify -format "%[width]" $1`
        metadata["height"]=`identify -format "%[height]" $1`
        metadata["colorspace"]=`identify -format "%[colorspace]" $1`
        #identify -format "%[resolution.x], %[resolution.y], %[size], %[width], %[height], %[colorspace]" $1
    fi

    echo "$1 info"
    echo "path: $full_file_path"
    echo "base name: $base_name"
    echo "extension: $extension"
    echo "metadata: ${(kv)metadata}"
    #if [[]]
}

#@ $1 deploy
function deploy2yaml () {
    #
    # @Description  This is deployment from associative array to yaml
    # @params       $1: associative array
    # @Example      deploy2yaml associative_lst
    # @Reference    
    #

}

#@ $1 deploy
function deploy2json () {
    #
    # @Description  This is deployment from associative array to json
    # @params       $1: associative array
    # @Example      deploy2json
    # @Reference    https://stackoverflow.com/questions/442012/in-zsh-how-do-i-pass-anonymous-arrays-into-functions
    #

}

#@ what
function what_environment_is_this () {
    #
    # @Description  show environment
    # @params       
    # @Example      what_environment_is_this
    # @Reference    
    #

    local hostname=`hostname`
    local ip_address=`hostname -I`
    local num_process=`ps aux | wc -l`
    local gpu_status
}

#@ $1 what
function what_process_is_this () {
    #
    # @Description  show process info
    # @params       $1: process id
    # @Example      what_process_is_this 17
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

    ps -eo user,pid,ppid,c,lstart,tty,time,cmd | head -5
}

#@
function myawk () {
    """
        
    """
}

#function _assert() {
#    #
#    # $1: 条件式
#    # $2: 条件式がFalseの時に出力するメッセージ
#    # Reference: https://qiita.com/nannoki/items/15004992b6bb5637a9cd
#    #
#    eval $1
#    if [[ $? == 0 ]]; then
#        echo "great work!!!"
#    else
#        echo $2
#    fi
#}
#
#function test_add () {
#    _assert "$1"
#}

# function _assert () {
#     expected="$2"
#     input="$3"
# 
# 
#     ./9cc "$input" > tmp.s
#     cc -o tmp tmp.s
#     ./tmp
#     actual="$?"
# 
#     if [[ "$actual" == "$expected" ]]; then
#         echo "$input => $actual"
#     else
#         echo "$input => $expected expected, but got $actual"
#         exit 1
#     fi
# }


#@
function _assert () {
    #
    # @Description  command a & command b
    #               background command a
    #               foreground command b
    # @params       : command a
    #               : command b
    # @Example
    # @Reference    https://qiita.com/egawa_kun/items/714394609eef6be8e0bf
    #

}



#assert 0 0
#assert 42 42

#echo OK

#@ gulliver
function gutils_tic_toc () {
    #
    # Description:  Gutils tictoc
    # @params       $1: pattern
    # @return 
    # @example
    #               $ tic
    #               $ toc
    # Reference:    https://qiita.com/real_yaruo/items/0a1b4a88cfd5f27f062d
    #
    
}


#@ obsolete
function georgia_omscs () {
    #@ nest
    function matrials () {
        local -A material_lst=(
            apply           https://omscs.gatech.edu/program-info/application-deadlines-process-requirements
            zenn01          https://zenn.dev/magurotuna/articles/georgia-tech-omscs
            zenn02          https://zenn.dev/kakeami/articles/617efe3bf9841d
            zenn02_github   https://kakeami.github.io/road-to-gatech/
            zenn03_文系     https://zenn.dev/tofu511/articles/49b81ec2b6883e
            sugita          https://lapras.com/public/toshi0607
            yusuke_         https://github.com/magurotuna
            prerequisite    https://ja.takp.me/posts/how-i-was-accepted-to-georgia-tech-omscs/
        )
    }

    #@ nest
    function prerequisite () {
        local -a lst=(
            resume
            大学の成績証明書
            卒業証明書
            TOEFL_iBT
            statement_of_purpose
            recommendation_three
        )
    }

    #@ nest
    function deadline () {
        local -A sched=(
            spring      july_01st
            automn      march_01st
        )
    }
}

#@ $3
function _create_remote_repository () {
    #
    # @Description  create remote repository in github/gitlab
    #               This is empty.
    # @params       $1: github | gitlab
    #               $2: project name
    #               $3: use_template
    # @Example      create_remote_repository github segmentation_inference
    # @Reference    
    #

    local target_platform
    local project_name
    if [[ $# == 0 ]]; then
        local -a platforms=(
            github
            gitlab
        )
        target_platform=`array_fzf "$platforms[*]"`
        echo -n "project name> "
        read project_name
        echo -n "use template[yes/no]> "
        read use_template
    local OPTS
    if [[ $use_template == "yes" ]]; then
        OPTS="--template git@github.com:Bucchiman/Bproject.git"
    fi
    else
        target_platform=$1
        project_name=$2
    fi
    if [[ $target_platform == "github" ]]; then
        gh repo create $project_name --private --add-readme $OPTS
    else
        glab repo create $project_name --private --readme --defaultBranch main
    fi

}



# #@
# function default () {
#     #
#     # this is default setting
#     # you can run this function without no arguments.
#     #
#     echo "******************************"
#     echo "* default                    *"
#     echo "******************************"
#     echo "this is default setting"
#     echo "you can run this function without no arguments."
# }

#@
function search () {
    local load_readme=$(cd $HOME/.config/lib/readme; /usr/bin/find . -type f | fzf --height 100% )
}

#@
function search_keywords () {
    local -a tmp=($(awk '/#@/{$1="";print}' $BMODS_PATH))
    local -a keywords_lst=(${(u)tmp[@]})
    local target_keywords=`array_fzf "${keywords_lst[*]}"`
    echo $target_keywords
}





#######################################
#@ MAIN
function main () {
    set_variables
    fuzzy_settings
    if [[ $@ == "" ]]; then
    #    #
    #    # source modules
    #    # $ source Bmods
    #    #
    #elif [[ $@ == "." ]]; then
        # array_of_lines=("${(@f)$(my_command)}")
        # Reference: https://unix.stackexchange.com/questions/29724/how-to-properly-collect-an-array-of-lines-in-zsh
        # Reference: https://stackoverflow.com/questions/15691942/print-array-elements-on-separate-lines-in-bash
        # printf '%s\n' "${my_array[@]}"
        local target_func=`choose_Bmods_function`
        # echo $target_func
        eval ${target_func}
    else
        eval $@
    fi
}

# function _usage() {
#     echo "Usage: Bmods -B"
#     exit 1
# }

# if [[ $# = 0 ]]
# then
#     echo No arguments or options
#     exit 1
# fi

# while getopts b OPT
# do
#     case j in
#         b) echo hello; main_flag=1;;
#         :|\?) _usage;;
#     esac
# done

#if [[ $main_flag == 1 ]]; then
#    main
#fi

#ME=$0
#main $@
#######################################



#######################################
# 2023-10-28 18:59:55
# simply DEBUG
#######################################
# main @

#######################################

return
